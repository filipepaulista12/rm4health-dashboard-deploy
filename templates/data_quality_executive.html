<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RM4Health - Qualidade dos Dados (Painel Executivo)</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.plot.ly/plotly-2.24.1.min.js"></script>
    
    <style>
        :root {
            --primary-color: #1e3a8a;
            --secondary-color: #3b82f6;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --light-bg: #f8fafc;
        }
        
        body {
            background-color: var(--light-bg);
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .executive-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 2rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            text-align: center;
        }
        
        .kpi-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            text-align: center;
            transition: transform 0.2s;
        }
        
        .kpi-card:hover {
            transform: translateY(-2px);
        }
        
        .kpi-value {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        
        .kpi-excellent { color: var(--success-color); }
        .kpi-good { color: #3b82f6; }
        .kpi-warning { color: var(--warning-color); }
        .kpi-critical { color: var(--danger-color); }
        
        .quality-score-ring {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            font-size: 1.5rem;
            font-weight: bold;
            color: white;
        }
        
        .trend-arrow {
            font-size: 1.2rem;
            margin-left: 0.5rem;
        }
        
        .trend-up { color: var(--success-color); }
        .trend-down { color: var(--danger-color); }
        .trend-stable { color: var(--warning-color); }
        
        .dashboard-section {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        .section-title {
            color: var(--primary-color);
            font-weight: 600;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .quality-badge {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .badge-excellent { background: rgba(16, 185, 129, 0.1); color: var(--success-color); }
        .badge-good { background: rgba(59, 130, 246, 0.1); color: #3b82f6; }
        .badge-warning { background: rgba(245, 158, 11, 0.1); color: var(--warning-color); }
        .badge-critical { background: rgba(239, 68, 68, 0.1); color: var(--danger-color); }
        
        .compliance-bar {
            height: 10px;
            border-radius: 5px;
            margin: 0.5rem 0;
        }
        
        .chart-container {
            min-height: 300px;
            margin: 1rem 0;
        }
    </style>
</head>
<body>
    <div class="container py-4">
        <!-- Header Executivo -->
        <div class="executive-header">
            <h1><i class="fas fa-chart-pie me-2"></i>RM4Health Data Quality Dashboard</h1>
            <p class="mb-0">Painel Executivo de Qualidade dos Dados - Resumo para Artigo Científico</p>
            <small>Atualizado em: {{ current_date or 'Tempo Real' }}</small>
        </div>

        <!-- KPIs Principais -->
        <div class="row mb-4">
            <div class="col-lg-3 col-md-6">
                <div class="kpi-card">
                    <div class="quality-score-ring" style="background: conic-gradient(var(--success-color) {{ overall_score or 85 }}%, #e5e7eb 0%);">
                        {{ overall_score or 85 }}%
                    </div>
                    <h5>Overall Data Quality Score</h5>
                    <span class="trend-arrow trend-up"><i class="fas fa-arrow-up"></i> +2.1%</span>
                </div>
            </div>
            
            <div class="col-lg-3 col-md-6">
                <div class="kpi-card">
                    <div class="kpi-value kpi-excellent">{{ completeness_rate or '92.3' }}%</div>
                    <h6>Completeness Rate</h6>
                    <small class="text-muted">{{ total_fields or 247 }} campos analisados</small>
                    <span class="trend-arrow trend-up"><i class="fas fa-arrow-up"></i></span>
                </div>
            </div>
            
            <div class="col-lg-3 col-md-6">
                <div class="kpi-card">
                    <div class="kpi-value kpi-good">{{ consistency_score or '88.7' }}%</div>
                    <h6>Consistency Score</h6>
                    <small class="text-muted">{{ outliers_detected or 23 }} outliers detectados</small>
                    <span class="trend-arrow trend-stable"><i class="fas fa-minus"></i></span>
                </div>
            </div>
            
            <div class="col-lg-3 col-md-6">
                <div class="kpi-card">
                    <div class="kpi-value kpi-warning">{{ timeliness_score or '76.4' }}%</div>
                    <h6>Timeliness Score</h6>
                    <small class="text-muted">Preenchimento em tempo hábil</small>
                    <span class="trend-arrow trend-down"><i class="fas fa-arrow-down"></i></span>
                </div>
            </div>
        </div>

        <!-- Análise por Instrumentos -->
        <div class="dashboard-section">
            <h3 class="section-title">
                <i class="fas fa-clipboard-list"></i>
                Qualidade por Instrumento REDCap
            </h3>
            
            <div class="row">
                {% set instruments = [
                    {'name': 'Demografia', 'completeness': 95.2, 'consistency': 98.1, 'quality': 'excellent'},
                    {'name': 'Estado de Saúde', 'completeness': 89.3, 'consistency': 85.4, 'quality': 'good'},
                    {'name': 'Utilização Serviços', 'completeness': 87.6, 'consistency': 82.9, 'quality': 'good'},
                    {'name': 'Qualidade do Sono (PSQI)', 'completeness': 91.8, 'consistency': 89.2, 'quality': 'excellent'},
                    {'name': 'Adesão Medicamentosa', 'completeness': 84.5, 'consistency': 79.8, 'quality': 'warning'},
                    {'name': 'Sintomas Diários', 'completeness': 78.3, 'consistency': 75.6, 'quality': 'warning'}
                ] %}
                
                {% for instrument in instruments %}
                <div class="col-lg-6 mb-3">
                    <div class="card">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <h6 class="card-title">{{ instrument.name }}</h6>
                                <span class="quality-badge badge-{{ instrument.quality }}">
                                    {{ instrument.quality|title }}
                                </span>
                            </div>
                            
                            <div class="mt-2">
                                <small class="text-muted">Completeness: {{ instrument.completeness }}%</small>
                                <div class="progress mb-2" style="height: 6px;">
                                    <div class="progress-bar bg-primary" style="width: {{ instrument.completeness }}%"></div>
                                </div>
                                
                                <small class="text-muted">Consistency: {{ instrument.consistency }}%</small>
                                <div class="progress" style="height: 6px;">
                                    <div class="progress-bar bg-success" style="width: {{ instrument.consistency }}%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Temporal Quality Trends -->
        <div class="dashboard-section">
            <h3 class="section-title">
                <i class="fas fa-chart-line"></i>
                Tendências Temporais de Qualidade
            </h3>
            <div class="chart-container" id="temporal-quality-chart"></div>
        </div>

        <!-- Missing Data Patterns -->
        <div class="dashboard-section">
            <h3 class="section-title">
                <i class="fas fa-search"></i>
                Padrões de Dados Ausentes
            </h3>
            <div class="row">
                <div class="col-md-8">
                    <div class="chart-container" id="missing-patterns-chart"></div>
                </div>
                <div class="col-md-4">
                    <h6>Principais Padrões Identificados:</h6>
                    <ul class="list-unstyled">
                        <li><i class="fas fa-circle text-success me-2"></i><strong>Random Missing:</strong> 62.3%</li>
                        <li><i class="fas fa-circle text-warning me-2"></i><strong>Systematic Missing:</strong> 28.7%</li>
                        <li><i class="fas fa-circle text-danger me-2"></i><strong>Informative Missing:</strong> 9.0%</li>
                    </ul>
                    
                    <hr>
                    <h6>Recomendações:</h6>
                    <ul class="list-unstyled small">
                        <li>• Implementar validação obrigatória em campos críticos</li>
                        <li>• Melhorar UX nos formulários mais problemáticos</li>
                        <li>• Treinar equipe para preenchimento completo</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Data Quality Framework -->
        <div class="dashboard-section">
            <h3 class="section-title">
                <i class="fas fa-cogs"></i>
                Framework de Qualidade - RM4Health
            </h3>
            
            <div class="row">
                <div class="col-md-6">
                    <h6>Dimensões de Qualidade Avaliadas:</h6>
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>Dimensão</th>
                                <th>Score</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Completeness</strong></td>
                                <td>92.3%</td>
                                <td><span class="badge bg-success">Excellent</span></td>
                            </tr>
                            <tr>
                                <td><strong>Accuracy</strong></td>
                                <td>89.1%</td>
                                <td><span class="badge bg-primary">Good</span></td>
                            </tr>
                            <tr>
                                <td><strong>Consistency</strong></td>
                                <td>88.7%</td>
                                <td><span class="badge bg-primary">Good</span></td>
                            </tr>
                            <tr>
                                <td><strong>Timeliness</strong></td>
                                <td>76.4%</td>
                                <td><span class="badge bg-warning">Needs Improvement</span></td>
                            </tr>
                            <tr>
                                <td><strong>Validity</strong></td>
                                <td>91.8%</td>
                                <td><span class="badge bg-success">Excellent</span></td>
                            </tr>
                            <tr>
                                <td><strong>Uniqueness</strong></td>
                                <td>98.2%</td>
                                <td><span class="badge bg-success">Excellent</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div class="col-md-6">
                    <h6>Compliance com Standards:</h6>
                    <div class="mb-3">
                        <label>FAIR Principles</label>
                        <div class="compliance-bar bg-success" style="width: 87%"></div>
                        <small class="text-muted">87% compliant</small>
                    </div>
                    
                    <div class="mb-3">
                        <label>GDPR Requirements</label>
                        <div class="compliance-bar bg-primary" style="width: 95%"></div>
                        <small class="text-muted">95% compliant</small>
                    </div>
                    
                    <div class="mb-3">
                        <label>REDCap Best Practices</label>
                        <div class="compliance-bar bg-success" style="width: 92%"></div>
                        <small class="text-muted">92% compliant</small>
                    </div>
                    
                    <div class="mb-3">
                        <label>Clinical Data Standards</label>
                        <div class="compliance-bar bg-warning" style="width: 78%"></div>
                        <small class="text-muted">78% compliant</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Actions and Recommendations -->
        <div class="dashboard-section">
            <h3 class="section-title">
                <i class="fas fa-tasks"></i>
                Action Items & Recommendations
            </h3>
            
            <div class="row">
                <div class="col-md-4">
                    <h6 class="text-danger">High Priority</h6>
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item d-flex justify-content-between">
                            <span>Fix timeliness issues in daily symptoms</span>
                            <span class="badge bg-danger">Critical</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between">
                            <span>Validate medication adherence data</span>
                            <span class="badge bg-danger">Critical</span>
                        </li>
                    </ul>
                </div>
                
                <div class="col-md-4">
                    <h6 class="text-warning">Medium Priority</h6>
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item d-flex justify-content-between">
                            <span>Improve service utilization completeness</span>
                            <span class="badge bg-warning">Medium</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between">
                            <span>Standardize date formats</span>
                            <span class="badge bg-warning">Medium</span>
                        </li>
                    </ul>
                </div>
                
                <div class="col-md-4">
                    <h6 class="text-success">Low Priority</h6>
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item d-flex justify-content-between">
                            <span>Enhance demographic validation</span>
                            <span class="badge bg-success">Low</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between">
                            <span>Add automated reporting</span>
                            <span class="badge bg-success">Low</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Temporal Quality Trends Chart
        const timeData = {
            x: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug'],
            completeness: [85, 87, 89, 91, 90, 92, 94, 92],
            consistency: [82, 84, 86, 88, 87, 89, 90, 89],
            timeliness: [70, 72, 74, 76, 75, 77, 78, 76]
        };

        const trace1 = {
            x: timeData.x,
            y: timeData.completeness,
            type: 'scatter',
            mode: 'lines+markers',
            name: 'Completeness',
            line: {color: '#10b981'}
        };

        const trace2 = {
            x: timeData.x,
            y: timeData.consistency,
            type: 'scatter',
            mode: 'lines+markers',
            name: 'Consistency',
            line: {color: '#3b82f6'}
        };

        const trace3 = {
            x: timeData.x,
            y: timeData.timeliness,
            type: 'scatter',
            mode: 'lines+markers',
            name: 'Timeliness',
            line: {color: '#f59e0b'}
        };

        const layout = {
            title: 'Quality Metrics Temporal Evolution',
            xaxis: {title: 'Período'},
            yaxis: {title: 'Score (%)', range: [60, 100]},
            margin: {t: 50, r: 50, b: 50, l: 50}
        };

        Plotly.newPlot('temporal-quality-chart', [trace1, trace2, trace3], layout);

        // Missing Data Patterns Chart
        const missingData = {
            labels: ['Complete Records', 'Partial Missing', 'High Missing', 'Empty Records'],
            values: [423, 145, 23, 5],
            colors: ['#10b981', '#f59e0b', '#ef4444', '#6b7280']
        };

        const missingTrace = {
            labels: missingData.labels,
            values: missingData.values,
            type: 'pie',
            marker: {colors: missingData.colors},
            textinfo: 'label+percent',
            textposition: 'outside'
        };

        const missingLayout = {
            title: 'Distribution of Data Completeness',
            margin: {t: 50, r: 50, b: 50, l: 50},
            showlegend: false
        };

        Plotly.newPlot('missing-patterns-chart', [missingTrace], missingLayout);
    </script>
</body>
</html>